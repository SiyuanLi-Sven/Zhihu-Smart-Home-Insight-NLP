"use strict";(self.webpackChunkheifetz=self.webpackChunkheifetz||[]).push([[5829],{97127:function(e,t,n){n.d(t,{Z:function(){return e3}});var i,r=n(94009),o=n(85879),a=n(65733),l=n(14168),c=n.n(l),s=n(87363),d=n(43384),u=n(47842),h=n(87320),p=n(55164),f=n(71728),g=n(87641),m=n(57477),v={LOCAL:{type:"local",name:"上传图片"},EMOTICON:{type:"emoticon",name:"表情包"},PUBLIC:{type:"public",name:"网络素材"},PRIVATE:{type:"private",name:"个人素材"},LATEST:{type:"latest",name:"最近使用"}},x=Object.values(v),y=Object.keys(v).reduce(function(e,t){return(0,m._)((0,p._)({},e),(0,h._)({},t,v[t].type))},{});Object.keys(v).reduce(function(e,t){return(0,m._)((0,p._)({},e),(0,h._)({},v[t].type,v[t].name))},{});var Z={ALL:{type:"all",name:"全部"},STATIC:{type:"static",name:"普通图片"},DYNAMIC:{type:"dynamic",name:"动图"}};Object.values(Z),Object.keys(Z).reduce(function(e,t){return(0,m._)((0,p._)({},e),(0,h._)({},t,Z[t].type))},{}),Object.keys(Z).reduce(function(e,t){return(0,m._)((0,p._)({},e),(0,h._)({},Z[t].type,Z[t].name))},{});var I=function(e){var t=e.active,n=(0,f._)(e,["active"]);return(0,o.tZ)(d.$U,(0,p._)({as:"button",zaType:"Button",zaText:!0,zaAction:"Unknown",color:"GBK03A",shouldTrackShow:!0,css:function(e){return[{marginRight:"20px",lineHeight:"50px",fontSize:"15px",cursor:"pointer"},t&&{position:"relative",fontWeight:"bold","::after":{position:"absolute",left:"0",bottom:"0",content:"''",display:"block",width:"100%",height:"4px",backgroundColor:e.colors.GBL01A,flexShrink:"0"}}]}},n))},b=function(e){var t=e.tabType,n=e.tabChange,i=e.tabs,r=i?x.filter(function(e){var t=e.type;return i.includes(t)}):x;return(0,o.BX)(g.Flex,{alignItems:"center",justifyContent:"space-between",css:function(e){return{height:"50px",padding:"0 20px",boxShadow:"inset 0px -0.5px 0px ".concat(e.colors.GBK09A)}},children:[(0,o.tZ)(g.Flex,{children:r.map(function(e){return(0,o.tZ)(I,{active:t===e.type,onClick:function(){n(e.type)},children:e.name},e.type)})}),(0,o.tZ)("div",{className:"MaterialLibrary-SearchInputContainer"})]})};b.propTypes={tabType:c().string,tabChange:c().func};var _=n(10840),B=n(20382),C=n(49274),L=n(79091),k=n(81956),A=n(88423),S=n(51940),T=n(62641),w=n(80565),E=n(43831),z=function(){return new Promise(requestAnimationFrame)},G=function(e,t,n){e({eventType:"Click",action:"Unknown",elementLocation:{type:t,text:n}})},R=function(e){var t=(0,d.Q4)().trackEvent,n=(0,r._)((0,s.useState)(null),2),i=n[0],a=n[1],l="ready"===i,c=function(n){n.stopPropagation(),"loading"!==i&&(a("loading"),G(t,"Button","加载 gif"),Promise.all([(0,A.loadImage)(e),z().then(z)]).then(function(){a("ready")}).catch(function(){a("error")}))},u=null;return u="loading"===i||l?(0,o.tZ)(S.e1,{className:"MaterialLibrary-GifIcon",onClick:c}):"error"===i?(0,o.tZ)(S.wT,{className:"MaterialLibrary-GifIcon",onClick:c}):(0,o.tZ)(S.OU,{className:"MaterialLibrary-GifIcon",onClick:c}),{isGifReady:l,gifIcon:u}},F=function(){return(0,o.tZ)(g.Box,{color:"GBK02A",width:"96px",css:function(e){return{position:"absolute",left:"4px",bottom:"4px",width:"48px",height:"16px",lineHeight:"16px",textAlign:"center",fontSize:"12px",background:e.colors.GBL05A,color:e.colors.GBK99A,borderRadius:"2px",zIndex:1}},children:"已删除"})},N=function(e){return(0,o.tZ)(d.$U,(0,p._)({as:g.Flex,zaType:"Button",zaAction:"Unknown",alignItems:"center",justifyContent:"center",width:"24px",height:"24px",css:{borderRadius:"2px",position:"absolute",lineHeight:"24px"}},e))},X=function(e){var t=e.data,n=e.chooseImage,i=e.deleted,r=e.deleteSingleImage,a=e.imageUrl,l=e.poster,c=e.isPrivate,s=void 0!==c&&c,u=(0,d.Q4)().trackEvent,h=(0,T.D)(),f=(0,A.imgUrl)(a||(null==t?void 0:t.origin),"100w"),v=R(f),x=v.isGifReady,y=v.gifIcon,Z=x?f:(0,A.imgUrl)(l||(null==t?void 0:t.thumbnail),"100w"),I="dynamic"===t.subtype?Z:f;return(0,o.BX)(g.Box,{color:"GBK02A",width:s?"96px":"105px",css:[{display:"inline-block",marginBottom:"10px",marginLeft:s?"14px":"5px",verticalAlign:"top",".MaterialLibrary-GifIcon":{position:"absolute",width:"46px",height:"46px",marginLeft:"-23px",marginTop:"-23px",top:"50%",left:"50%",transition:"0.3s ease-out",transitionProperty:"transform, opacity",transform:"scale(1)",transformOrigin:"center",opacity:"1"}},x&&{".MaterialLibrary-GifIcon":{transform:"scale(0.3)",opacity:"0",width:0,height:0,margin:0}}],children:[(0,o.BX)(g.Box,{width:s?"96px":"105px",height:s?"96px":"105px",css:function(e){return{borderRadius:"2px",cursor:"pointer",position:"relative",backgroundColor:e.colorMod(e.colors.GBK02A).alpha(.08),"&:hover > .MaterialLibrary-imgListItemHover":{display:"flex",backgroundColor:e.colorMod(e.colors.GBK02A).alpha(.3)}}},onClick:function(){i||(n(t),G(u,"Image","".concat((null==t?void 0:t.checked)?"取消选中图片":"选中图片")))},children:[(0,o.tZ)(g.Image,{src:I,loading:"lazy",size:"100%",css:(0,p._)({position:"absolute",left:0,right:0,objectFit:"cover",borderRadius:"inherit",opacity:i?"0.3":"1"},h)}),(0,o.tZ)(g.Box,{sx:{color:"GBK99A",border:"2px solid",borderColor:"GBL01A"},css:function(e){return(0,p._)({display:(null==t?void 0:t.checked)?"flex":"none",position:"absolute",top:"0",left:"0",right:"0",width:"100%",height:"100%",borderRadius:"inherit"},(null==t?void 0:t.checked)&&{backgroundColor:e.colorMod(e.colors.GBK02A).alpha(.3)})},className:"MaterialLibrary-imgListItemHover",children:i?(0,o.tZ)(N,{zaText:"删除图片",title:"删除",css:function(e){return{bottom:"2px",right:"2px",backgroundColor:e.colors.GBL01A}},onClick:function(e){e.stopPropagation(),r(t)},children:(0,o.tZ)(E.R,{fill:"currentColor",size:18})}):(0,o.tZ)(N,{zaType:"Image",zaText:"选中图片",title:"选中图片",onClick:function(e){e.stopPropagation(),n(t)},css:function(e){return{top:"6px",right:"6px",border:"2px solid ".concat((null==t?void 0:t.checked)?e.colors.GBL01A:e.colors.GBK99A),borderRadius:"50%"}}})}),(null==t?void 0:t.checked)&&(0,o.tZ)(N,{zaType:"Image",zaText:"取消选中图片",title:"取消选中图片",onClick:function(e){e.stopPropagation(),n(t)},css:function(e){return{top:"8px",right:"8px",fontSize:"14px",textAlign:"center",backgroundColor:e.colors.GBL01A,color:e.colors.GBK99A,borderRadius:"50%"}},children:null==t?void 0:t.checkedIndex}),"dynamic"===t.subtype&&y,i&&(0,o.tZ)(F,{})]}),(0,o.tZ)(g.Box,{mt:"4px",fontSize:"10px",lineHeight:"20px",css:(0,m._)((0,p._)({},(0,w.S)(1)),{wordBreak:"break-all"}),title:"文件名称",children:null==t?void 0:t.name})]})};X.propTypes={data:c().string,chooseImage:c().func,getLatestList:c().func};var H=n(99178),P=function(e){return(0,o.tZ)("i",(0,p._)({css:{marginLeft:"14px",width:"96px"}},e))},M=function(e){var t=e.children,n=(0,f._)(e,["children"]);return(0,o.BX)(H.ZP,(0,m._)((0,p._)({css:{display:"flex",flex:1,overflow:"auto",flexWrap:"wrap",justifyContent:"space-between",alignContent:"flex-start",height:"100%",marginLeft:"-5px",padding:"0 20px 0"}},n),{children:[t,(0,o.tZ)(P,{}),(0,o.tZ)(P,{}),(0,o.tZ)(P,{}),(0,o.tZ)(P,{}),(0,o.tZ)(P,{}),(0,o.tZ)(P,{})]}))},D=n(91486),U=function(e){var t=e.checked,n=e.onChange,i=(0,f._)(e,["checked","onChange"]);return(0,o.BX)(g.Flex,(0,m._)((0,p._)({alignItems:"center",css:function(e){return{fontSize:"13px",color:e.colors.GBL04A}}},i),{children:[(0,o.tZ)(D.C,{type:"checkbox",checked:t,onChange:function(e){n(e.target.checked)},size:15,css:{marginRight:"5px",marginTop:"1px"}}),"本页全选"]}))},K=n(49899),j=n(57730),O=n(74135),W=(0,s.createContext)({}),V=function(){return(0,s.useContext)(W)},Y=function(e){var t=e.onClose,n=e.sourceType,i=e.sourceId,r=e.insertImage,a=e.setTabType,l=e.initLocalList,c=e.setInitLocalList,d=e.children,u=e.maxImage,h=e.imgAutoRotate;return(0,o.tZ)(W.Provider,{value:(0,s.useMemo)(function(){return{onClose:t,sourceType:n,sourceId:i,insertImage:r,setTabType:a,initLocalList:l,setInitLocalList:c,maxImage:u,imgAutoRotate:h}},[t,n,i,r,a,l,c,u,h]),children:d})},q=function(e){var t=e.itemKey,n=(0,k.Z)(),i=(0,d.Q4)().trackEvent,o=V(),l=o.sourceId,c=o.sourceType,u=o.insertImage,h=o.onClose,f=(0,r._)((0,s.useState)([]),2),g=f[0],v=f[1],x=(0,r._)((0,s.useState)(!0),2),y=x[0],Z=x[1],I=(0,r._)((0,s.useState)(!1),2),b=I[0],_=I[1],B=(0,r._)((0,s.useState)(!1),2),C=B[0],L=B[1],A=(0,r._)((0,s.useState)(!1),2),S=A[0],T=A[1],w=(0,r._)((0,s.useState)("all"),2),E=w[0],z=w[1],G=(0,r._)((0,s.useState)(null),2),R=G[0],F=G[1],N=g.length&&g.every(function(e){return e.checked}),X=function(){Z(!0),T(!1),L(!1),F(null),v([]),_(!1)},H=(0,a.Z)(function(e,t){if(Z(!1),t)T(!0);else{var n;j.Z.alert((null==e?void 0:e.message)||(null==e?void 0:null===(n=e.error)||void 0===n?void 0:n.message)||"网络错误，稍后重试吧!")}}),P=(0,a.Z)(function(e){var t,n=(0,O.camelizeKeys)(e.payload||{});Z(!1),L(null==n?void 0:null===(t=n.paging)||void 0===t?void 0:t.isEnd),F(null==n?void 0:n.paging),v(function(e){return e.concat((null==n?void 0:n.data)||[])})}),M=(0,a.Z)(function(e){v(function(n){var i,r=(0,K._)(n),o=r.find(function(n){return e[t]===n[t]}),a=(null===(i=null==r?void 0:r.map(function(e){return null==e?void 0:e.checkedIndex}).sort(function(e,t){return t-e}))||void 0===i?void 0:i[0])||0;return o&&(o.checked=!o.checked,o.checked?o.checkedIndex=a+1:(r.forEach(function(e){(null==e?void 0:e.checkedIndex)>o.checkedIndex&&e.checkedIndex--}),delete o.checkedIndex)),r})});return{materialList:g,setMaterialList:v,paging:R,isLoading:y,setIsLoading:Z,hasInited:b,setHasInited:_,isDrained:C,setIsDrained:L,isPageError:S,setIsPageError:T,subTypeCatch:E,setSubTypeCatch:z,selectAllChecked:N,toggleSelectAll:function(e){e&&i({action:"Unknown",eventType:"Click",elementLocation:{type:"Button",text:"本页全选"}}),v(function(t){return t.map(function(t,n){return(0,m._)((0,p._)({},t),{checked:e,checkedIndex:e?n+1:void 0})})})},reset:X,handleSubTypeChange:function(e){b&&e!==E&&(z(e),X())},handleResponseErrorData:H,handleResponseData:P,chooseImage:M,insertImages:(0,a.Z)(function(e){u(e.map(function(e){return e.origin})),n("".concat(location.origin,"/api/v4/materials/pc_editor/recently-materials"),{method:"POST",body:{source_type:c,source_id:String(l),material_type:"image",material_ids:e.map(function(e){return e.materialId})}}),h()})}},$=function(e){return(0,o.tZ)(g.Flex,(0,p._)({justifyContent:"space-between",css:{padding:"10px 20px 10px 8px"}},e))},Q=function(e){return(0,o.tZ)("div",(0,m._)((0,p._)({css:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"}},e),{children:"加载中..."}))},J=function(e){return(0,o.tZ)(d.$U,(0,p._)({as:"button",zaType:"Button",zaText:!0,zaAction:"Unknown",css:{marginRight:"10px",padding:"7px 15px",fontSize:"14px",borderRadius:"3px","&:last-child":{marginRight:0}}},e))},ee=function(e){var t=e.active,n=(0,f._)(e,["active"]);return(0,o.tZ)(J,(0,p._)({css:function(e){return[{background:e.colorMod(e.colors.GBL01A).alpha(.3),color:e.colors.GBK99A,"&[disabled]":{opacity:.5,cursor:"default"}},t&&{background:e.colors.GBL01A}]}},n))},et=function(e){return(0,o.tZ)(J,(0,p._)({css:function(e){return{background:e.colors.GBK10A,color:e.colors.GBK03A}}},e))},en=function(e){return(0,o.tZ)(J,(0,p._)({css:function(e){return{background:e.colors.GBK10A,color:e.colors.GRD03A}}},e))},ei=function(e){return(0,o.tZ)("svg",(0,m._)((0,p._)({},e),{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,o.tZ)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 0C11.4477 0 11 0.447716 11 1V11H1C0.447715 11 0 11.4477 0 12C0 12.5523 0.447716 13 1 13H11V23C11 23.5523 11.4477 24 12 24C12.5523 24 13 23.5523 13 23V13H23C23.5523 13 24 12.5523 24 12C24 11.4477 23.5523 11 23 11H13V1C13 0.447715 12.5523 0 12 0Z",fill:"#999999"})}))},er=function(e){return(null==e?void 0:e.length)?e.sort(function(e,t){return(null==e?void 0:e.checkedIndex)-(null==t?void 0:t.checkedIndex)}):[]},eo=function(e){var t=e.isPageError,n=e.keywordCatch,i=e.reset;return t?(0,o.tZ)(C.H.EI1A,{image:"loadingError",content:"网络连接失败",buttonText:"刷新页面",buttonOnClick:i}):(0,o.tZ)(C.H.EI1A,{image:"default",content:"没有找到".concat(n?"「"+n+"」":"","相关内容"),buttonText:"搜索其他内容",buttonOnClick:function(){var e;null===(e=document.querySelector(".materials_library_public_search"))||void 0===e||e.focus()}})},ea=function(e){var t=e.dataList,n=e.insertImages,i=(0,f._)(e,["dataList","insertImages"]),r=(t||[]).filter(function(e){return!0===e.checked});return(0,o.tZ)(g.Flex,(0,m._)((0,p._)({css:{padding:"13px 20px"},justifyContent:"flex-end"},i),{children:(0,o.tZ)(ee,{active:r.length>0,onClick:function(){n(er(r))},css:{margin:0},zaText:"插入图片；图片数：".concat(r.length||0),children:"插入图片"})}))},el=function(e){var t=e.keywordCatch,n=(0,f._)(e,["keywordCatch"]),i=(0,k.Z)(),r=V(),l=r.insertImage,c=r.onClose,d=q({itemKey:"id"}),u=d.materialList,h=d.paging,v=d.isLoading,x=d.setIsLoading,y=d.hasInited,Z=d.setHasInited,I=d.isDrained,b=d.isPageError,_=d.setIsPageError,B=d.selectAllChecked,C=d.toggleSelectAll,A=d.reset,S=d.handleResponseErrorData,T=d.handleResponseData,w=d.chooseImage,E=!u.length,z=(0,a.Z)(function(){return x(!0),_(!1),i((null==h?void 0:h.next)||(0,L.D)("".concat(location.origin,"/api/v4/materials/pc_editor/search"),{offset:null==u?void 0:u.length,limit:24,keyword:t||"表情包"}))}),G=(0,a.Z)(function(){return z().then(T).catch(function(e){S(e.payload)})}),R=(0,a.Z)(function(e){l(e.map(function(e){return e.origin})),c()});(0,s.useEffect)(function(){y||z().then(T).catch(function(e){S(e.payload,!0)}).finally(function(){Z(!0)})},[y,Z,z,T,S]);var F=E?!v&&(0,o.tZ)(eo,{isPageError:b,keywordCatch:t,reset:A}):(0,o.BX)(o.HY,{children:[(0,o.tZ)(M,{getContainer:function(e){return e},onLoad:G,isLoading:v,isDrained:I,children:u.map(function(e,t){return(0,o.tZ)(X,{data:e,insertImages:R,chooseImage:w},String([e.id,t]))})}),(0,o.tZ)(ea,{dataList:u,insertImages:R})]});return(0,o.BX)(g.Flex,(0,m._)((0,p._)({flexDirection:"column",color:"GBL05A",css:{height:"530px",fontSize:"12px"}},n),{children:[(0,o.BX)($,{children:[(0,o.tZ)("div",{className:"MaterialLibrary-SearchTipsContainer",children:t&&!E&&!v&&!b&&(0,o.BX)(g.Box,{color:"GBK03A",width:"200px",css:{margin:"0px 12px",fontSize:"12px"},children:["以下为「",t,"」相关搜索内容"]})}),(0,o.tZ)(U,{checked:B,onChange:C})]}),y?F:(0,o.tZ)(Q,{})]}))},ec="materialId",es=function(e){var t=e.isPageError,n=e.reset,i=V().setTabType;return t?(0,o.tZ)(C.H.EI1A,{image:"loadingError",content:"网络连接失败",buttonText:"刷新页面",buttonOnClick:n}):(0,o.tZ)(C.H.EI1A,{image:"default",content:"最近使用为空，请搜索网络素材或上传图片",buttonText:"上传图片",buttonOnClick:function(){i(y.PRIVATE)}})},ed=function(e){var t=e.dataList,n=e.deleteImages,i=e.insertImages,r=(0,f._)(e,["dataList","deleteImages","insertImages"]),a=(t||[]).filter(function(e){return!0===e.checked});return(0,o.BX)(g.Flex,(0,m._)((0,p._)({css:{padding:"13px 20px"},justifyContent:a.length>0?"space-between":"flex-end"},r),{children:[a.length>0&&(0,o.tZ)(en,{onClick:function(){0!==a.length&&j.Z.confirm((0,o.BX)("div",{className:"MaterialLibrary-alert",children:[(0,o.BX)("h2",{children:["是否删除已选择共 ",a.length," 张图片？"]}),(0,o.tZ)("p",{children:"插入至内容中的图片不会受到影响"})]}),{text:{ok:"删除",cancel:"取消"}}).then(function(){n(a.map(function(e){return e[ec]}))},function(){})},children:"删除图片"}),(0,o.tZ)(ee,{active:a.length>0,onClick:function(){i(er(a))},zaText:"插入图片；图片数：".concat(a.length||0),children:"插入图片"})]}))},eu=n(87376),eh=n(29229),ep=n(95548),ef=n.n(ep),eg=n(53778),em=n(17132),ev=n.n(em),ex=n(67927),ey=n(48825),eZ=n(38020),eI=n(82644),eb=n(44812),e_=function(e){var t,n=e.data,i=e.deleteImage,r=e.reUploadImage,a=e.dragWrapRef,l=n||{},c=l.tag,s=l.index,d=(null==a?void 0:null===(t=a.current)||void 0===t?void 0:t.clientWidth)||746,u={cursor:"pointer",userDrag:"none",userSelect:"none",WebkitUserDrag:"none",WebkitUserSelect:"none"};return(0,o.BX)(g.Box,{id:c.originSrc+s,css:function(e){return(0,p._)({position:"relative",display:"inline-block",width:"105px",height:"105px",margin:"0 calc(".concat(d-655,"px / 12) 15px"),borderRadius:"2px",background:e.colors.GBK10C,"&:active":{filter:"drop-shadow(0px 3px 6px rgba(0, 0, 0, 0.15)) drop-shadow(0px 0px 4px rgba(0, 0, 0, 0.3))"}},"pending"===c.status&&u)},children:[(0,o.tZ)(g.Image,{src:c.originSrc,width:"100%",height:"100%",css:{borderRadius:"2px"},sx:{objectFit:"cover"}}),(0,o.BX)(g.Box,{css:function(e){return{position:"absolute",top:0,left:0,width:"105px",height:"105px",borderRadius:"2px",zIndex:2,backgroundColor:e.colorMod(e.colors.GBK02A).alpha("success"===c.status?0:.4),"& .CircleLoadingBar .path":{stroke:e.colors.GBK99A},"&:hover":{".close":{display:"block"}}}},children:["pending"===c.status&&(0,o.tZ)(eZ.Z,{}),(0,o.tZ)(g.Box,{className:"close",css:function(e){return(0,p._)({position:"absolute",top:"-10px",right:"-9px",zIndex:3,width:"20px",height:"20px",lineHeight:"21px",fontSize:"15px",textAlign:"center",borderRadius:"50%",display:"none",backgroundColor:e.colorMod(e.colors.GBK02A).alpha(.4),color:e.colors.GBK99A,"&>span":{marginLeft:"1px"}},u)},onClick:function(){return i(c,s)},children:(0,o.tZ)(eI.HN,{center:!0,width:"13px",height:"13px"})}),"error"===c.status&&(0,o.BX)(o.HY,{children:[(0,o.BX)(g.Flex,{fontSize:"15px",fontWeight:"400",height:"82px",color:"GBK99A",alignItems:"center",justifyContent:"center",css:u,onClick:function(){return r(c.file,s)},children:[(0,o.tZ)(eb.x,{width:"20px",height:"22px"}),(0,o.tZ)(g.Text,{ml:"3px",children:"重试"})]}),(0,o.tZ)(g.Box,{css:function(e){return{position:"absolute",bottom:0,left:0,zIndex:3,width:"100%",height:"23px",lineHeight:"23px",fontSize:"12px",fontWeight:400,textAlign:"center",backgroundColor:e.colorMod(e.colors.GBK99A).alpha(.8),color:e.colors.GRD03A,borderRadius:"0 0 1px 1px"}},children:"上传失败"})]})]})]},c.originSrc+s)},eB=n(91199),eC=function(e){var t=e.handleUploadImage,n=e.content,i=e.style,r=void 0===i?{}:i,a=e.isLocal,l=(0,s.useRef)(),c=(0,d.Q4)().trackEvent;return(0,o.BX)(o.HY,{children:[(0,o.tZ)("input",{css:{display:"none"},ref:l,type:"file",onChange:function(e){t(e),a&&(l.current.value=null);var n,i=e.target.files;(null==i?void 0:i.length)&&(null===(n=Array.from(i))||void 0===n||n.forEach(function(e){(0,A.loadImage)(window.URL.createObjectURL(e)).then(function(t){var n=t.height,i=t.width;c({eventType:"Click",action:"Upload",elementLocation:{type:"Button",moduleId:"image_upload"}},{configMap:{fileSize:String(e.size),imageWidth:String(i),imageHeight:String(n),imageFormat:e.name.split(".").pop(),pixels:String(n*i)}})})}))},accept:"image/*",multiple:!0}),(0,o.tZ)(d.$U,{zaType:"Button",zaText:"本地上传图片",as:g.Flex,role:"button",width:"92px",height:"32px",lineHeight:"32px",fontSize:"12px",color:"GBL05A",alignItems:"center",justifyContent:"center",ml:"19px",mb:"6px",onClick:function(){return l.current.click()},css:function(e){return(0,p._)({verticalAlign:"top",display:"inline-flex",cursor:"pointer",borderRadius:"2px",backgroundColor:e.colorMod(e.colors.GBL05A).alpha(.08)},r)},children:n||(0,o.BX)(o.HY,{children:[(0,o.tZ)(eB.We,{}),(0,o.tZ)(g.Text,{ml:"3px",mt:"2px",children:"本地上传"})]})})]})},eL=function(e){var t=e.handleUploadImage,n=(0,f._)(e,["handleUploadImage"]);return(0,o.tZ)(g.Flex,(0,m._)((0,p._)({},n),{height:"100%",alignItems:"center",justifyContent:"center",children:(0,o.BX)(g.Box,{textAlign:"center",children:[(0,o.tZ)(eC,{handleUploadImage:t,style:{width:"104px",height:"104px",border:"1px dashed #d3d3d3",margin:0,background:"transparent",borderRadius:"8px","&:hover":{background:"rgba(246, 246, 246, 0.3)"}},content:(0,o.tZ)(ei,{})}),(0,o.tZ)(g.Text,{color:"GBK02A",fontSize:"14px",fontWeight:"500",mt:"10px",children:"上传图片"}),(0,o.tZ)(g.Text,{color:"GBK06A",fontSize:"12px",mt:"4px",children:"支持 JPG、JPEG、PNG 等格式"})]})}))},ek=function(e){var t=e.src,n=e.originalSrc,i=e.watermarkSrc,r=e.privateWatermarkSrc,o=e.watermark,a=e.dataRawwidth,l=e.dataRawheight,c=e.hash,s=(0,A.imgUrl)(t,{quality:ev()(navigator.userAgent).Mobile?50:80,size:window.devicePixelRatio>=1.5?"1440w":"720w"});return{src:s,url:s,originalSrc:n,watermarkSrc:i,privateWatermarkSrc:r,watermark:o,rawWidth:a,rawHeight:l,id:c}},eA=function(e){var t=e.dataList,n=e.insertImages,i=e.onClose,r=e.maxImage,a=(0,f._)(e,["dataList","insertImages","onClose","maxImage"]),l=!!r&&t.length>r;return(0,o.BX)(g.Flex,(0,m._)((0,p._)({css:{padding:"13px 20px",position:"relative"},alignItems:"center",justifyContent:"flex-end"},a),{children:[r&&(null==t?void 0:t.length)>0&&(0,o.BX)(g.Box,{css:{position:"absolute",left:20,top:20,display:"flex"},color:"GBK03A",fontSize:"13px",children:[(0,o.tZ)(g.Text,{css:{color:l&&"red"},children:t.length}),"/",r,(0,o.BX)(g.Text,{css:{opacity:.9,marginLeft:5},children:["(最多上传 ",r," 张图片)"]})]}),(null==t?void 0:t.length)>0&&(0,o.BX)(g.Text,{color:"GBK03A",fontSize:"14px",fontWeight:"400",mr:"10px",children:["已上传 ",t.length," 张图片，拖拽可调整顺序"]}),(0,o.tZ)(ee,{active:t.length>0,onClick:function(){n(t.map(function(e){return e.data||{}}),!0),i()},disabled:l,zaText:"插入图片；图片数：".concat(t.length||0),children:"插入图片"})]}))},eS=function(e){var t=e.handleUploadImage,n=e.errorList,i=e.reUpload;return(0,o.BX)(g.Flex,{alignItems:"center",justifyContent:"space-between",children:[(0,o.tZ)(eC,{handleUploadImage:t,style:{margin:"5px 0 4px 20px",height:"32px"},isLocal:!0}),(null==n?void 0:n.length)>0&&(0,o.BX)(g.Flex,{alignItems:"center",mr:"20px",mt:"1px",fontSize:"14px",children:[(0,o.BX)(g.Text,{color:"GRD03A",children:[n.length," 张上传失败"]}),(0,o.tZ)(g.Text,{css:function(e){return{width:"114px",height:"32px",lineHeight:"32px",marginLeft:"10px",borderRadius:"3px",cursor:"pointer",background:e.colors.GBK10A,color:e.colors.GBL01A,fontWeight:500,textAlign:"center"}},onClick:i,children:"批量重新上传"})]})]})},eT=function(){var e=((0,eh.Z)(function(){return Promise.all([n.e(8885),n.e(5389)]).then(n.t.bind(n,50526,23))})||{}).DraggableArea,t=(0,s.useRef)(),i=(0,eg.useDispatch)(),a=V().sourceType,l=V(),c=l.insertImage,d=l.onClose,u=l.initLocalList,h=l.setInitLocalList,f=l.maxImage,v=l.imgAutoRotate,x=(0,r._)((0,s.useState)(u||[]),2),y=x[0],Z=x[1],I=(0,s.useRef)(y);(0,s.useEffect)(function(){I.current=y},[y]),(0,s.useEffect)(function(){return Z(u),function(){var e;h(null===(e=I.current)||void 0===e?void 0:e.map(function(e){return(0,p._)({},e,"pending"===e.status&&{status:"error"})}))}},[]);var b=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=e.findIndex(function(e){return e.id===t}),r=(0,K._)(e);return -1!==i&&r.splice(i,1,(0,p._)({},e[i],n)),r},_=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(e){var r=(null==n?void 0:n.isUpload)?null==n?void 0:n.imageList:y;r.splice(t,1,(0,m._)((0,p._)({},r[t]),{status:"pending"})),Z(function(){return(0,K._)(r)}),i((0,ey.Ix)(e,"default",a,v)).then(function(e){var n=e.payload;Z(function(e){var i;return b(e,null===(i=r[t])||void 0===i?void 0:i.id,{data:ek(n),status:"success"})})}).catch(function(){Z(function(e){var n;return b(e,null===(n=r[t])||void 0===n?void 0:n.id,{status:"error"})})})}},B=function(e,t){var n=t.length-1;_(t[n].file,n,{isUpload:!0,imageList:t})},C=function(e){var t,n=e.target.files;if(null==n?void 0:n.length){if((null==n?void 0:n.length)>100){j.Z.alert("添加图片请不要超过 100 张哦~");return}null===(t=Array.from(n))||void 0===t||t.forEach(function(e){(0,eu.fs)({file:e,preset:eu.PG.content}).then(function(){Z(function(t){var i=(0,K._)(t).concat([{originSrc:window.URL.createObjectURL(e),status:"pending",id:ef()("image"),file:e}]);return B(n,i),i})}).catch(function(e){i((0,ex.c0)(e.message||"图片上传未完成，请稍后发布","red"))})})}},L=function(e,t){var n=(0,K._)(y);n.splice(t,1),Z(n)},k=function(e){var t=[];return null==e||e.forEach(function(e,n){"error"===e.status&&t.push((0,m._)((0,p._)({},e),{index:n}))}),t};return(null==y?void 0:y.length)?(0,o.BX)(o.HY,{children:[(0,o.tZ)(eS,{handleUploadImage:C,errorList:k(y),reUpload:function(){var e;null===(e=k(y))||void 0===e||e.forEach(function(e){return _(e.file,e.index)})}}),(0,o.tZ)(g.Box,{ref:t,css:{position:"relative",width:"100%",height:"505px",overflowY:"scroll",padding:"10px 12.5px 16px",lineHeight:"0.8"},children:e?(0,o.tZ)(e,{tags:y.map(function(e){return(0,m._)((0,p._)({},e),{id:"".concat(e.id,"_").concat(e.status)})}),render:function(e){return(0,o.tZ)(e_,{data:e,deleteImage:L,reUploadImage:_,dragWrapRef:t})},onChange:function(e){Z(e.map(function(e){var t,n;return(0,m._)((0,p._)({},e),{id:(null===(t=null===(n=e.id)||void 0===n?void 0:n.split("_"))||void 0===t?void 0:t[0])||ef()("image")})}))}}):y.map(function(e,n){return(0,o.tZ)(e_,{data:{tag:e,index:n},deleteImage:L,reUploadImage:_,dragWrapRef:t},"".concat(e.id,"_").concat(n))})}),(0,o.tZ)(eA,{dataList:y.filter(function(e){return"success"===e.status}),onClose:d,insertImages:c,maxImage:f})]}):(0,o.tZ)(eL,{css:{marginTop:"-20px"},handleUploadImage:C})},ew=n(33961),eE=n(71746),ez=n(45001),eG=function(e){var t=(0,k.Z)(),n=(0,r._)((0,s.useState)({}),2),i=n[0],o=n[1],l=(0,r._)((0,s.useState)(!1),2),c=l[0],d=l[1],u=(0,r._)((0,s.useState)(""),2),h=u[0],p=u[1],f=(0,r._)((0,s.useState)(!1),2),g=f[0],m=f[1],v=(0,a.Z)(function(){m(!1),o({}),d(!1)}),x=(0,a.Z)(function(){return t("".concat(location.origin,"/api/v4/materials/pc_editor/folders?type=").concat(e,"&material_type=image")).then(function(e){var t,n=(0,O.camelizeKeys)((null===(t=e.payload)||void 0===t?void 0:t.data)||{});return o(n),n})});return(0,s.useEffect)(function(){c||x().then(function(e){var t,n;p(null==e?void 0:null===(t=e.child)||void 0===t?void 0:null===(n=t[0])||void 0===n?void 0:n.id)}).catch(function(){m(!0)}).finally(function(){d(!0)})},[c,x]),{hasInited:c,isPageError:g,setIsPageError:m,reset:v,folders:i,getFoldersList:x,activeFolderId:h,setActiveFolderId:p}},eR=n(93975),eF=n(45074),eN=n(51695),eX=n(55890),eH=n(25628),eP=n.n(eH),eM=function(e){var t=e.type,n=e.className,i=e.inputShowName,a=e.resetInput,l=e.folderId,c=e.getFoldersList,d=(0,k.Z)(),u=(0,s.useRef)(),h=(0,r._)((0,s.useState)(void 0===i?"":i),2),p=h[0],f=h[1],g=function(){"add"!==t&&p&&d("".concat(location.origin,"/api/v4/materials/pc_editor/folders/").concat(l),{method:"PUT",body:{name:p}}).then(function(){var e;null===(e=u.current)||void 0===e||e.blur(),c&&c()}).catch(function(e){var t,n,i;j.Z.alert((null===(t=e.payload)||void 0===t?void 0:t.message)||(null===(n=e.payload)||void 0===n?void 0:null===(i=n.error)||void 0===i?void 0:i.message)||"网络错误，稍后重试吧!")})};return(0,o.tZ)("input",{ref:u,type:"text",className:eP()("MaterialLibrary-input-module",n),placeholder:"请输入文件名称",autoFocus:"autofocus",onChange:function(e){f(e.target.value)},value:p,onBlur:function(){a&&a(""),g()},onKeyUp:function(e){if(13===e.keyCode){var t;null===(t=u.current)||void 0===t||t.blur()}}})};eM.propTypes={inputShowName:c().string,resetInput:c().func};var eD=function(e){return(0,o.tZ)(d.$U,(0,p._)({as:g.Flex,zaType:"Button",alignItems:"center",justifyContent:"center",width:"16px",height:"16px",css:function(e){return{borderRadius:"12px",backgroundColor:e.colors.GBK99A,cursor:"pointer","&+&":{marginLeft:"4px"}}}},e))},eU=function(e){var t,n=e.folders,i=void 0===n?{}:n,a=e.activeFolderId,l=e.getFoldersList,c=e.folderClick,d=e.reset,u=(0,k.Z)(),h=(0,r._)((0,s.useState)(""),2),p=h[0],f=h[1],m=(0,r._)((0,s.useState)(""),2),v=m[0],x=m[1],y=function(e,t){"nav-edit"===e?(f(t.id),x(t.name)):"nav-delete"===e&&j.Z.confirm((0,o.BX)("div",{className:"MaterialLibrary-alert",children:[(0,o.tZ)("h2",{children:"是否删除已选择分类？"}),(0,o.tZ)("p",{children:"分类中的图片将归入未分类中"})]}),{text:{ok:"删除",cancel:"取消"}}).then(function(){u("".concat(location.origin,"/api/v4/materials/pc_editor/folders/").concat(t.id),{method:"DELETE",body:{delete_material:!1}}).then(function(e){var t,n;(null===(t=e.payload)||void 0===t?void 0:t.success)?(j.Z.alert("已成功删除分组，该分组的图片已移动至「我的图片-未分类」"),d()):j.Z.alert((null===(n=e.payload)||void 0===n?void 0:n.message)||"网络错误，稍后重试吧！")})},function(){})};return(null==i?void 0:i.hidden)?null:(0,o.BX)("div",{className:"MaterialLibraryNav",children:[(0,o.BX)("div",{className:"MaterialLibraryNav-nav",children:[(0,o.BX)(g.Flex,{className:"MaterialLibraryNav-Mine",justifyContent:"space-between",alignItems:"center",children:[(0,o.BX)(g.Flex,{justifyContent:"space-between",alignItems:"center",children:[(0,o.tZ)(eR.y,{className:"nav-icon"}),null==i?void 0:i.name]}),(0,o.tZ)("div",{className:"nav-num",children:null==i?void 0:i.materialCount})]}),null==i?void 0:null===(t=i.child)||void 0===t?void 0:t.map(function(e){return(0,o.BX)(g.Flex,{className:eP()("MaterialLibraryNav-Folder",{active:a===e.id}),justifyContent:"space-between",alignItems:"center",onClick:function(){c(e.id)},children:[(0,o.BX)(g.Flex,{justifyContent:"space-between",alignItems:"center",children:[(0,o.tZ)(eF._,{className:"nav-icon"}),p!==e.id&&(0,o.tZ)("div",{className:"nav-name",children:e.name})]}),p!==e.id&&(0,o.tZ)("div",{className:eP()("nav-num",{"disable-hover":!e.supportEdit&&!e.supportDelete}),children:e.materialCount||0}),p!==e.id&&(e.supportEdit||e.supportDelete)&&(0,o.BX)(g.Flex,{className:"nav-handle",children:[e.supportEdit&&(0,o.tZ)(eD,{zaText:"编辑",onClick:function(t){t.stopPropagation(),y("nav-edit",e)},children:(0,o.tZ)(eN.yc,{fill:"currentColor",size:10})}),e.supportDelete&&(0,o.tZ)(eD,{zaText:"删除",onClick:function(t){t.stopPropagation(),y("nav-delete",e)},children:(0,o.tZ)(eI.HN,{fill:"currentColor",size:10})})]}),p===e.id&&(0,o.tZ)(eM,{folderId:e.id,inputShowName:v,getFoldersList:l,resetInput:function(e){f(e)}})]},e.id)})]}),(0,o.BX)(g.Flex,{className:"MaterialLibraryNav-Add",justifyContent:"space-between",alignItems:"center",onClick:function(){var e;if((null==i?void 0:null===(e=i.child)||void 0===e?void 0:e.length)>15){j.Z.alert("分组已达上限，请删除已有的分类后再行添加");return}j.Z.confirm((0,o.BX)("div",{className:"MaterialLibrary-alert",children:[(0,o.tZ)("h2",{children:"添加分类"}),(0,o.tZ)(eM,{type:"add",className:"MaterialLibraryNav-input-module"})]}),{text:{ok:"添加",cancel:"取消"}}).then(function(){var e,t=null===(e=document.querySelector(".MaterialLibrary-input-module"))||void 0===e?void 0:e.value;u("".concat(location.origin,"/api/v4/materials/pc_editor/folders"),{method:"POST",body:{name:t,material_type:"image"}}).then(function(){l()}).catch(function(e){var t,n,i;j.Z.alert((null===(t=e.payload)||void 0===t?void 0:t.message)||(null===(n=e.payload)||void 0===n?void 0:null===(i=n.error)||void 0===i?void 0:i.message)||"网络错误，稍后重试吧!")})},function(){})},children:[(0,o.tZ)(eX.dU,{className:"nav-icon"}),"添加分类"]})]})};eU.propTypes={folders:c().object,getFoldersList:c().func,folderClick:c().func};var eK="uniqueId",ej=function(e){var t=e.isPageError,n=e.handleUploadImage,i=e.reset;return t?(0,o.tZ)(o.HY,{children:(0,o.tZ)(C.H.EI1A,{image:"loadingError",content:"网络连接失败",buttonText:"刷新页面",buttonOnClick:i})}):(0,o.tZ)(eL,{css:{marginTop:"-50px"},handleUploadImage:n})},eO=function(e){var t=e.dataList,n=e.activeFolderId,i=e.folders,r=e.getFoldersList,a=e.insertImages,l=(0,f._)(e,["dataList","activeFolderId","folders","getFoldersList","insertImages"]),c=(0,k.Z)(),d=(t||[]).filter(function(e){return!0===e.checked}),u=(0,s.useMemo)(function(){var e;return null==i?void 0:null===(e=i.child)||void 0===e?void 0:e.filter(function(e){return e.id!==n})},[i,n]);return(0,o.BX)(g.Flex,(0,m._)((0,p._)({css:{padding:"13px 20px"},justifyContent:d.length>0?"space-between":"flex-end"},l),{children:[d.length>0&&(0,o.tZ)(en,{onClick:function(){0!==d.length&&j.Z.confirm((0,o.BX)("div",{className:"MaterialLibrary-alert",children:[(0,o.BX)("h2",{children:["是否删除已选择共 ",d.length," 张图片？"]}),(0,o.tZ)("p",{children:"插入至内容中的图片不会受到影响"})]}),{text:{ok:"删除",cancel:"取消"}}).then(function(){c("".concat(location.origin,"/api/v4/materials/pc_editor/folders/").concat(n,"/materials"),{method:"DELETE",body:{material_type:"image",folder_material_ids:d.map(function(e){return e[eK]})}}).then(function(e){var t,n;(null===(t=e.payload)||void 0===t?void 0:t.success)?r():j.Z.alert((null===(n=e.payload)||void 0===n?void 0:n.message)||"网络错误，稍后重试吧！")})},function(){})},children:"删除图片"}),(0,o.BX)(g.Box,{children:[d.length>0&&(null==u?void 0:u.length)>0&&(0,o.tZ)(et,{css:{width:"86px"},onClick:function(){if(0!==d.length){var e=u[0].id;j.Z.confirm((0,o.BX)("div",{className:"MaterialLibrary-alert",children:[(0,o.BX)("h2",{children:["为已选择共 ",d.length," 张图片分类"]}),(0,o.tZ)(ez.Z,{buttonClassName:"MaterialLibraryContent-select",listClassName:"MaterialLibraryContent-option",value:n,onChange:function(t){e=t},children:u.map(function(e){var t=e.name,n=e.id;return(0,o.tZ)(ez.W,{value:n,text:t,children:t},n)})})]}),{text:{ok:"确定",cancel:"取消"}}).then(function(){c("".concat(location.origin,"/api/v4/materials/pc_editor/material-move"),{method:"POST",body:{folder_id:n,target_folder_id:e,folder_material_ids:d.map(function(e){return e[eK]})}}).then(function(e){var t,n;(null===(t=e.payload)||void 0===t?void 0:t.success)?r():j.Z.alert((null===(n=e.payload)||void 0===n?void 0:n.message)||"网络错误，稍后重试吧！")})},function(){})}},children:"移动"}),(0,o.tZ)(ee,{active:d.length>0,onClick:function(){a(er(d))},zaText:"插入图片；图片数：".concat(d.length||0),children:"插入图片"})]})]}))},eW=function(e){var t=e.activeFolderId,n=e.getFoldersList,i=e.folders,r=(0,k.Z)(),l=(0,eg.useDispatch)(),c=q({itemKey:eK}),d=c.materialList,u=c.paging,h=c.isLoading,p=c.setIsLoading,f=c.hasInited,m=c.setHasInited,v=c.isDrained,x=c.isPageError,y=c.setIsPageError,Z=c.selectAllChecked,I=c.toggleSelectAll,b=c.reset,_=c.handleResponseErrorData,B=c.handleResponseData,C=c.chooseImage,A=c.insertImages,S=!d.length,T=(0,a.Z)(function(){return p(!0),y(!1),r((null==u?void 0:u.next)||(0,L.D)("".concat(location.origin,"/api/v4/materials/pc_editor/folders/").concat(t,"/materials"),{offset:null==d?void 0:d.length,limit:24}))}),w=(0,a.Z)(function(){return T().then(B).catch(function(e){_(e.payload)})}),E=function(e){r("".concat(location.origin,"/api/v4/materials/pc_editor/folders/").concat(t,"/materials"),{method:"POST",body:{material_type:"image",materials:e}}).then(function(e){var t,i;(null===(t=e.payload)||void 0===t?void 0:t.success)?n():j.Z.alert((null===(i=e.payload)||void 0===i?void 0:i.message)||"网络错误，稍后重试吧！")}).catch(function(e){var t,n,i;j.Z.alert((null===(t=e.payload)||void 0===t?void 0:t.message)||(null===(n=e.payload)||void 0===n?void 0:null===(i=n.error)||void 0===i?void 0:i.message)||"网络错误，稍后重试吧!")})},z=function(e){var t=e.target.files;if(null==t?void 0:t.length){if((null==t?void 0:t.length)>100){j.Z.alert("添加图片请不要超过 100 张哦~");return}var n=[],i=!0,r=!1,o=void 0;try{for(var a,c=t[Symbol.iterator]();!(i=(a=c.next()).done);i=!0)!function(){var e=a.value;(0,eu.fs)({file:e,preset:eu.PG.content}).then(function(){(0,ew.Z)(e).then(function(i){(0,eE.Z)(i).then(function(i){(n=n.concat({name:null==e?void 0:e.name,source:null==i?void 0:i.original_hash})).length===t.length&&E(n)})})}).catch(function(e){l((0,ex.c0)(e.message||"图片上传未完成，请稍后发布","red"))})}()}catch(e){r=!0,o=e}finally{try{i||null==c.return||c.return()}finally{if(r)throw o}}}};(0,s.useEffect)(function(){!f&&t&&T().then(B).catch(function(e){_(e.payload,!0)}).finally(function(){m(!0)})},[f,m,t,T,B,_]);var G=S?!h&&(0,o.tZ)(ej,{handleUploadImage:z,isPageError:x,reset:b}):(0,o.BX)(o.HY,{children:[(0,o.tZ)(g.Box,{mt:"-36px",width:"100px",children:(0,o.tZ)(eC,{handleUploadImage:z},d.length)}),(0,o.tZ)(M,{getContainer:function(e){return e},onLoad:w,isLoading:h,isDrained:v,css:{marginLeft:"-14px"},children:d.map(function(e,t){return(0,o.tZ)(X,{data:e,chooseImage:C,insertImages:A,isPrivate:!0},String([e[eK],t]))})}),(0,o.tZ)(eO,{dataList:d,folders:i,activeFolderId:t,getFoldersList:n,insertImages:A})]});return(0,o.BX)(o.HY,{children:[(0,o.tZ)($,{children:(0,o.tZ)(U,{css:{marginLeft:"auto"},checked:Z,onChange:I})}),f?G:(0,o.tZ)(Q,{})]})},eV=n(44066),eY=n(61533),eq=n(95377),e$=function(e){var t=e.onSearch,n=(0,f._)(e,["onSearch"]),i=(0,r._)((0,s.useState)(""),2),a=i[0],l=i[1],c=(0,r._)((0,s.useState)(null),2),d=c[0],u=c[1];return(0,s.useEffect)(function(){u(document.querySelector(".MaterialLibrary-SearchInputContainer"))},[]),d&&(0,eY.createPortal)((0,o.tZ)(eq.Z,(0,p._)({className:"materials_library_public_search",onChange:function(e){return l(e.target.value)},value:a,after:(0,o.tZ)(eV.J7,{text:!0,onClick:function(){t(a)}}),onKeyUp:function(e){13===e.keyCode&&t(a)},css:function(e){return{width:"198px",height:"28px",lineHeight:"28px",fontSize:"12px",color:e.colors.GBL05A,backgroundColor:e.colors.GBK99A,border:"1px solid",borderColor:e.colors.GBK08A}}},n)),d)};c().string,c().func;var eQ="uniqueId",eJ=function(e){var t=e.isPageError,n=e.keywordCatch,i=e.reset;return t?(0,o.tZ)(C.H.EI1A,{image:"loadingError",content:"网络连接失败",buttonText:"刷新页面",buttonOnClick:i}):(0,o.tZ)(C.H.EI1A,{image:"default",content:"没有找到".concat(n?"「"+n+"」":"","相关内容"),buttonText:"搜索其他内容",buttonOnClick:function(){var e;null===(e=document.querySelector(".materials_library_public_search"))||void 0===e||e.focus()}})},e0=function(e){var t=e.dataList,n=e.insertImages,i=(0,f._)(e,["dataList","insertImages"]),r=(t||[]).filter(function(e){return!0===e.checked});return(0,o.tZ)(g.Flex,(0,m._)((0,p._)({css:{padding:"13px 20px"},justifyContent:"flex-end"},i),{children:(0,o.tZ)(ee,{active:r.length>0,onClick:function(){n(er(r))},zaText:"插入图片；图片数：".concat(r.length||0),children:"插入图片"})}))},e1=function(e){var t=e.keywordCatch,n=e.activeFolderId,i=V(),r=i.sourceId,l=i.sourceType,c=(0,k.Z)(),d=q({itemKey:eQ}),u=d.materialList,h=d.paging,p=d.isLoading,f=d.setIsLoading,m=d.hasInited,v=d.setHasInited,x=d.isDrained,y=d.isPageError,Z=d.setIsPageError,I=d.subTypeCatch,b=(d.handleSubTypeChange,d.selectAllChecked),_=d.toggleSelectAll,B=d.reset,C=d.handleResponseErrorData,A=d.handleResponseData,S=d.chooseImage,T=d.insertImages,w=!u.length,E=(0,a.Z)(function(){return f(!0),Z(!1),c((null==h?void 0:h.next)||(0,L.D)("".concat(location.origin,"/api/v4/materials/pc_editor/folders/").concat(n,"/search"),{offset:null==u?void 0:u.length,limit:24,keyword:t,source_type:l,source_id:r,sub_type:I}))}),z=(0,a.Z)(function(){return E().then(A).catch(function(e){C(e.payload)})});(0,s.useEffect)(function(){!m&&n&&E().then(A).catch(function(e){C(e.payload,!0)}).finally(function(){v(!0)})},[m,n,v,E,A,C]);var G=w?!p&&(0,o.tZ)(eJ,{isPageError:y,keywordCatch:t,reset:B}):(0,o.BX)(o.HY,{children:[(0,o.tZ)(M,{getContainer:function(e){return e},onLoad:z,isLoading:p,isDrained:x,children:u.map(function(e,t){return(0,o.tZ)(X,{data:e,insertImages:T,chooseImage:S},String([e[eQ],t]))})}),(0,o.tZ)(e0,{dataList:u,insertImages:T})]});return(0,o.BX)(o.HY,{children:[(0,o.BX)($,{children:[(0,o.BX)("div",{className:"MaterialLibrary-SearchTipsContainer",children:[!1,t&&!w&&!p&&!y&&(0,o.BX)(g.Box,{color:"GBK03A",width:"200px",css:{margin:"0px 12px",fontSize:"12px"},children:["以下为「",t,"」相关搜索内容"]})]}),(0,o.tZ)(U,{checked:b,onChange:_})]}),m?G:(0,o.tZ)(Q,{})]})},e2=(i={},(0,h._)(i,y.LOCAL,function(e){var t=(0,_._)({},(0,B._)(e));return(0,o.tZ)(o.HY,{children:(0,o.tZ)(g.Flex,(0,m._)((0,p._)({flexDirection:"column",color:"GBL05A",css:{height:"530px",fontSize:"12px"}},t),{children:(0,o.tZ)(eT,(0,p._)({},t))}))})}),(0,h._)(i,y.EMOTICON,function(e){var t=(0,_._)({},(0,B._)(e)),n=(0,r._)((0,s.useState)(""),1)[0];return(0,o.tZ)(o.HY,{children:(0,o.tZ)(el,(0,p._)({keywordCatch:n},t),n)})}),(0,h._)(i,y.PUBLIC,function(e){var t=(0,_._)({},(0,B._)(e)),n=(0,r._)((0,s.useState)(""),2),i=n[0],a=n[1],l=eG(y.PUBLIC),c=l.hasInited,d=l.reset,u=l.isPageError,h=l.activeFolderId,f=u?(0,o.tZ)(eJ,{isPageError:!0,reset:d}):(0,o.tZ)(e1,(0,p._)({keywordCatch:i,activeFolderId:h},t),i);return(0,o.BX)(o.HY,{children:[(0,o.tZ)(e$,{placeholder:"搜索网络素材库",onSearch:a}),(0,o.tZ)(g.Flex,(0,m._)((0,p._)({flexDirection:"column",color:"GBL05A",css:{height:"530px",fontSize:"12px"}},t),{children:c?f:(0,o.tZ)(Q,{css:{marginTop:42}})}))]})}),(0,h._)(i,y.PRIVATE,function(e){var t,n=(0,_._)({},(0,B._)(e)),i=eG(y.PRIVATE),r=i.hasInited,a=i.getFoldersList,l=i.reset,c=i.isPageError,s=i.folders,d=i.activeFolderId,u=i.setActiveFolderId,h=null===(t=s.child)||void 0===t?void 0:t.find(function(e){return e.id===d}),f=c?(0,o.tZ)(ej,{isPageError:!0,reset:l}):(0,o.tZ)(eW,(0,p._)({folders:s,activeFolderId:d,getFoldersList:a},n),String([d,null==h?void 0:h.materialCount]));return(0,o.BX)(g.Flex,{color:"GBL05A",css:{height:"530px",overflow:"hidden",fontSize:"12px"},children:[!c&&(0,o.tZ)(eU,{folders:s,activeFolderId:d,folderClick:function(e){d!==e&&u(e)},getFoldersList:a,reset:l}),(0,o.tZ)(g.Flex,(0,m._)((0,p._)({flexDirection:"column",color:"GBL05A",css:{height:"530px",fontSize:"12px",flex:1}},n),{children:r?f:(0,o.tZ)(Q,{css:{marginTop:42}})}))]})}),(0,h._)(i,y.LATEST,function(e){var t=(0,_._)({},(0,B._)(e)),n=(0,k.Z)(),i=q({itemKey:ec}),r=i.materialList,l=i.paging,c=i.isLoading,d=i.setIsLoading,u=i.hasInited,h=i.setHasInited,f=i.isDrained,v=i.isPageError,x=i.setIsPageError,y=i.selectAllChecked,Z=i.toggleSelectAll,I=i.reset,b=i.handleResponseErrorData,C=i.handleResponseData,A=i.chooseImage,S=i.insertImages,T=!r.length,w=(0,a.Z)(function(){return d(!0),x(!1),n((null==l?void 0:l.next)||(0,L.D)("".concat(location.origin,"/api/v4/materials/pc_editor/recently-materials"),{offset:null==r?void 0:r.length,limit:24,material_type:"image"}))}),E=(0,a.Z)(function(){return w().then(C).catch(function(e){b(e.payload)})}),z=(0,a.Z)(function(e){return n("".concat(location.origin,"/api/v4/materials/pc_editor/recently-materials"),{method:"DELETE",body:{material_type:"image",material_ids:e}}).then(function(e){var t,n;(null===(t=e.payload)||void 0===t?void 0:t.success)?I():j.Z.alert((null===(n=e.payload)||void 0===n?void 0:n.message)||"网络错误，稍后重试吧！")})}),G=(0,a.Z)(function(e){j.Z.confirm((0,o.BX)("div",{className:"MaterialLibrary-alert",children:[(0,o.tZ)("h2",{children:"是否从最近使用删除图片？"}),(0,o.tZ)("p",{children:"插入至内容中的图片不会受到影响"})]}),{text:{ok:"删除",cancel:"取消"}}).then(function(){z([e[ec]])},function(){})});(0,s.useEffect)(function(){u||w().then(C).catch(function(e){b(e.payload,!0)}).finally(function(){h(!0)})},[u,h,w,C,b]);var R=T?!c&&(0,o.tZ)(es,{isPageError:v,reset:I}):(0,o.BX)(o.HY,{children:[(0,o.tZ)(M,{getContainer:function(e){return e},onLoad:E,isLoading:c,isDrained:f,children:r.map(function(e,t){return(0,o.tZ)(X,{data:e,chooseImage:A,insertImages:S,deleted:e.deleted,deleteSingleImage:G},String([e[ec],t]))})}),(0,o.tZ)(ed,{dataList:r,deleteImages:z,insertImages:S})]});return(0,o.BX)(g.Flex,(0,m._)((0,p._)({flexDirection:"column",color:"GBL05A",css:{height:"530px",fontSize:"12px"}},t),{children:[(0,o.tZ)($,{children:(0,o.tZ)(U,{css:{marginLeft:"auto"},checked:y,onChange:Z})}),u?R:(0,o.tZ)(Q,{})]}))}),i),e5=function(e){var t=e.onClose,n=e.sourceType,i=e.sourceId,a=e.insertImage,l=e.maxImage,c=e.tabs,u=e.imgAutoRotate,h=e.initImage,p=(0,r._)((0,s.useState)(y.LOCAL),2),f=p[0],g=p[1],m=(0,r._)((0,s.useState)(void 0===h?[]:h),2),v=m[0],x=m[1],Z=e2[f];return(0,s.useEffect)(function(){var e=function(e){return e.preventDefault()};return document.addEventListener("drop",e,!1),document.addEventListener("dragover",e,!1),function(){document.removeEventListener("drop",e,!1),document.removeEventListener("dragover",e,!1)}},[]),(0,o.tZ)(Y,{onClose:t,sourceType:n,sourceId:i,insertImage:a,setTabType:g,initLocalList:v,setInitLocalList:x,maxImage:l,imgAutoRotate:u,children:(0,o.BX)("div",{children:[(0,o.tZ)(b,{tabType:f,tabChange:g,tabs:c}),Z&&(0,o.tZ)(d.eV,{block:f,children:(0,o.tZ)(Z,{})})]})})};e5.propTypes={sourceType:c().string,sourceId:c().number,onClose:c().func,insertImage:c().func,imgAutoRotate:c().bool};var e4=function(e,t){var n=e.sourceType,i=e.sourceId,l=e.insertImage,c=e.maxImage,h=e.tabs,p=e.initImage,f=e.imgAutoRotate,g=(0,r._)((0,s.useState)(!1),2),m=g[0],v=g[1],x=(0,a.Z)(function(){return v(function(e){return!e})});return(0,s.useImperativeHandle)(t,function(){return{toggleShown:x}},[x]),(0,o.tZ)(u.Z,{css:{minWidth:"746px",".Modal-content":{margin:0,padding:0}},onClose:x,children:m&&(0,o.tZ)(d.eV,{block:"MaterialLibrary",children:(0,o.tZ)(e5,{onClose:x,sourceType:n,sourceId:i,insertImage:l,maxImage:c,tabs:h,initImage:p,imgAutoRotate:f})})})};e4.propType={sourceType:c().string.isRequired,sourceId:c().number.isRequired,insertImage:c().func.isRequired};var e3=(0,s.forwardRef)(e4)},77263:function(e,t,n){var i=n(85879),r=n(25628),o=n.n(r),a=n(87363),l=n(87641),c=n(69383),s=n(43384),d=n(38889),u=n(66263);t.Z=function(e){var t=e.className,n=e.text,r=e.onFiles,h=e.zaClickId,p=e.zaBlockText,f=e.multiple,g=e.disabled,m=e.preset,v=e.size,x=e.icon,y=e.handleMouseEnter,Z=e.handleMouseLeave,I=(0,a.useRef)(null);return(0,i.BX)(i.HY,{children:[(0,i.tZ)(s.$U,{zaText:!0,zaType:"Button",as:l.Box,zaBlock:p,zaAction:"Upload",css:{display:"spread"===v?"block":"inline-block"},onMouseEnter:y,onMouseLeave:Z,children:(0,i.tZ)(d.ZP,{className:o()("VideoUploadButton",t),preset:m||"primary",size:v||"spread",color:"blue",disabled:g,icon:x,onClick:function(e){h&&c.Z.trackEvent(e.target,{id:h,action:"Upload"}),I.current.click()},children:n})}),(0,i.tZ)("input",{type:"file",className:"VideoUploadButton-fileInput",ref:I,onChange:function(){r(I.current.files,"Add"),I.current.value=null},accept:u.CZ.VIDEO.join(","),multiple:void 0===f||f})]})}},53438:function(e,t,n){var i=n(85879),r=n(24405),o=n(87363),a=n(87641);t.Z=(0,o.memo)(function(e){var t=e.className,n=e.showRuleDesc,o=(0,r.F)().colors;return(0,i.BX)(a.Box,{className:t,css:{fontSize:14,lineHeight:"22px",color:o.GBL05A,textAlign:"center",a:{textDecoration:"underline"}},children:[void 0!==n&&n&&(0,i.BX)(a.Flex,{marginTop:34,fontSize:10,width:688,justifyContent:"center",children:[(0,i.BX)(a.Box,{css:{width:"134px"},children:[(0,i.tZ)(a.Text,{css:{color:o.GBK04A,fontWeight:500,marginBottom:6},fontSize:13,children:"视频大小"}),(0,i.tZ)(a.Text,{fontSize:12,lineHeight:1.4,css:{color:o.GBK06A},children:"时长和大小均不限"}),(0,i.tZ)(a.Text,{fontSize:12,lineHeight:1.4,css:{color:o.GBK06A},children:"推荐上传大小为 5G 以内"})]}),(0,i.BX)(a.Box,{css:{width:"340px",position:"relative",margin:"0 40px","&::after,&::before":{content:'""',position:"absolute",width:1,height:20,verticalAlign:"middle",top:"50%",transform:"translate(0,-50%)",backgroundColor:o.GBK09A},"&::after":{left:0},"&::before":{right:0}},children:[(0,i.tZ)(a.Text,{css:{color:o.GBK04A,fontWeight:500,marginBottom:6},fontSize:13,children:"视频分辨率"}),(0,i.tZ)(a.Text,{fontSize:12,lineHeight:1.4,css:{color:o.GBK06A},children:"最大支持 1080P"}),(0,i.tZ)(a.Text,{fontSize:12,lineHeight:1.4,css:{color:o.GBK06A},children:"分辨率超过 1920 *1080，会被压缩为 1920 *1080"})]}),(0,i.BX)(a.Box,{css:{width:"134px"},children:[(0,i.tZ)(a.Text,{css:{color:o.GBK04A,fontWeight:500,marginBottom:6},fontSize:13,children:"视频格式"}),(0,i.tZ)(a.Text,{fontSize:12,lineHeight:1.4,css:{color:o.GBK06A},children:"支持常用视频格式"}),(0,i.tZ)(a.Text,{fontSize:12,lineHeight:1.4,css:{color:o.GBK06A},children:"推荐使用 mp4"})]})]}),(0,i.BX)(a.Text,{marginTop:35,color:o.GBL05A,fontSize:12,children:["上传视频，即代表您已同意"," ",(0,i.tZ)("a",{href:"https://www.zhihu.com/question/20118966",target:"_blank",rel:"noopener noreferrer",css:{color:o.GBL07A},children:"知乎视频使用规范"})," ","与"," ",(0,i.tZ)("a",{href:"https://www.zhihu.com/term/video",target:"_blank",rel:"noopener noreferrer",css:{color:o.GBL07A},children:"《知乎视频用户协议》"})]})]})})},86172:function(e,t){t.Z=function(e){var t=e.dataTransfer;return t.items?Array.from(t.items).filter(function(e){return"file"===e.kind}).map(function(e){return e.getAsFile()}):Array.from(t.files)}},45074:function(e,t,n){n.d(t,{_:function(){return c}});var i=n(87363),r=n.n(i),o=n(30851),a=Object.assign;function l(e){var t;return r().createElement(o.Z,a(a({width:"24",height:"24",viewBox:"0 0 24 24"},e),{className:"function"==typeof(t=e.className)?t():"ZDI ZDI--Folder24"+(t?" "+t:"")}),r().createElement("path",{fillRule:"evenodd",d:"M4.415 5.632a.915.915 0 0 0-.915.915v10.52c0 .505.41.914.915.914h14.153c.505 0 .915-.41.915-.915V9.045a.915.915 0 0 0-.915-.915H12.14a2.415 2.415 0 0 1-1.853-.866L9.198 5.96a.915.915 0 0 0-.702-.328h-4.08ZM2 6.547a2.415 2.415 0 0 1 2.415-2.415h4.081c.716 0 1.394.318 1.853.866l1.09 1.304a.915.915 0 0 0 .701.328h6.428a2.415 2.415 0 0 1 2.415 2.415v8.021a2.415 2.415 0 0 1-2.415 2.415H4.415A2.415 2.415 0 0 1 2 17.066V6.547Z",clipRule:"evenodd"}),r().createElement("path",{fillRule:"evenodd",d:"M5.25 11.5a.75.75 0 0 1 .75-.75h10a.75.75 0 0 1 0 1.5H6a.75.75 0 0 1-.75-.75Z",clipRule:"evenodd"}))}function c(e){return r().createElement(l,a(a({},e),{className:function(){return"Zi Zi--Folder"+(e.className?" "+e.className:"")}}))}},55890:function(e,t,n){n.d(t,{dU:function(){return s},j5:function(){return c}});var i=n(87363),r=n.n(i),o=n(30851),a=Object.assign;function l(e){var t;return r().createElement(o.Z,a(a({width:"24",height:"24",viewBox:"0 0 24 24"},e),{className:"function"==typeof(t=e.className)?t():"ZDI ZDI--FolderPlus24"+(t?" "+t:"")}),r().createElement("path",{fillRule:"evenodd",d:"M4.415 5.632a.915.915 0 0 0-.915.915v10.52c0 .505.41.914.915.914h8.413a.75.75 0 0 1 0 1.5H4.415A2.415 2.415 0 0 1 2 17.066V6.547a2.415 2.415 0 0 1 2.415-2.415h4.081c.715 0 1.394.318 1.853.866l1.09 1.304a.915.915 0 0 0 .701.328h6.428a2.415 2.415 0 0 1 2.415 2.415v1.954a.75.75 0 0 1-1.5 0V9.045a.915.915 0 0 0-.915-.915H12.14a2.415 2.415 0 0 1-1.853-.866L9.198 5.96a.915.915 0 0 0-.702-.328h-4.08Z",clipRule:"evenodd"}),r().createElement("path",{d:"M16.3 16.039a.75.75 0 0 0 0 1.5h2.1v2.1a.75.75 0 0 0 1.5 0v-2.1H22a.75.75 0 1 0 0-1.5h-2.1v-2.1a.75.75 0 0 0-1.5 0v2.1h-2.1Z"}))}function c(e){return r().createElement(l,a(a({},e),{className:function(){return"ZDI ZDI--Folderplus24"+(e.className?" "+e.className:"")}}))}function s(e){return r().createElement(l,a(a({},e),{className:function(){return"Zi Zi--FolderPlus"+(e.className?" "+e.className:"")}}))}}}]);
//# sourceMappingURL=shared-30b2a91d27f48fa9c977462bb1d69791a88a1110.8e240a077f2b539829a0.js.map